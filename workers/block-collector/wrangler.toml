name = "eds-block-collector"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

[vars]
ALLOWED_ORIGINS = "*"
# Developers are discovered dynamically from key Adobe repo contributors

# Browser Rendering for screenshots
[browser]
binding = "BROWSER"

# D1 Database for metadata storage
[[d1_databases]]
binding = "DB"
database_name = "block-database"
database_id = "8c2c1f69-5514-4346-9c15-fd3f56d35390"

# R2 Bucket for blob storage (screenshots, HTML, CSS)
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "block-assets"

# Workers AI for embeddings
[ai]
binding = "AI"

# Vectorize for semantic search
[[vectorize]]
binding = "VECTOR_INDEX"
index_name = "block-embeddings"

# Cron triggers for discovery and crawling
[triggers]
crons = ["0 * * * *", "0 2 * * SUN"]  # Every hour + Weekly discovery on Sunday 2AM UTC

# Environment-specific secrets (set via wrangler secret put):
# - GITHUB_TOKEN: Personal access token for GitHub API
# - WAPPALYZER_API_KEY: Wappalyzer technology detection API (optional)
# - LIGHTHOUSE_API_KEY: PageSpeed Insights API key (optional)
